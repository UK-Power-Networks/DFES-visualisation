!function(){var n={};function e(t,i){return this.target=t,0==S(this.target).length?{}:(this.attr=i||{},this.events={resize:""},this.attr.units=void 0===this.attr.units?"":this.attr.units,this.attr.formatX=void 0===this.attr.formatX?"function"==typeof this.attr.formatKey?this.attr.formatKey:function(t){return t}:this.attr.formatX,this.attr.formatY=void 0===this.attr.formatY?function(t){return this.attr.units+t}:this.attr.formatY,this.attr.formatBar=void 0===this.attr.formatBar?function(t,i,s){return""}:this.attr.formatBar,this.parent=void 0===this.attr.parent?this:this.attr.parent,this.drawn=!1,this.max=this.attr.max||void 0,this.min=this.attr.min||void 0,this.inc=this.attr.inc||void 0,this.mintick=this.attr.mintick||3,this.bin="function"==typeof this.attr.bin?this.attr.bin:function(t){return"string"===this.typ?this.fields[t]:Math.floor((t-this.min)/this.inc)},this.version=function(){return"0.9.9"},this)}void 0===Object.extend?n.extend=function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}:n.extend=Object.extend,e.prototype.isSelected=function(t){return b=this.bin(t),void 0===t&&(b=0),b>=this.nbins&&(b=this.nbins-1),b<0&&(b=0),"boolean"!=typeof this.bins[b].selected||this.bins[b].selected},e.prototype.select=function(t){for(var i=0;i<this.nbins;i++)this.bins[i].selected="all"==t,this.bins[i].selected?S("#"+this.bins[i].id).removeClass("deselected"):S("#"+this.bins[i].id).addClass("deselected");return this},e.prototype.toggleBin=function(t){return this.bins[t].selected=!this.bins[t].selected,S("#"+this.bins[t].id).toggleClass("deselected"),this},e.prototype.setData=function(t){return t&&"number"==typeof t.length&&(this.data=t),this},e.prototype.setBins=function(t){t=t||{};var i,s,e,a=!1,n=0<this.data.length&&"string"==typeof this.data[0][0]?"string":"number";if(this.typ&&n!=this.typ&&(a=!0),t.update&&(a=!0),this.typ=n,void 0===t.inc&&(t.inc=this.inc),void 0===t.max&&(t.max=this.max),void 0===t.min&&(t.min=this.min),void 0===t.mintick&&(t.mintick=this.mintick),t.inc!=this.inc&&(a=!0),t.min!=this.min&&(a=!0),t.max!=this.max&&(a=!0),"number"==this.typ&&("number"!=typeof t.inc&&(a=!0),typeof t.min!=n&&(a=!0),typeof t.max!=n&&(a=!0),"number"!=typeof t.mintick&&(a=!0)),this.bins||(a=!0),"string"==n){var h=0;if(a){for(this.fields={},this.bins={},s=0;s<this.data.length;s++)this.fields[this.data[s][0]]||(this.fields[this.data[s][0]]=h,h++),i=this.fields[this.data[s][0]],this.bins[i]||(this.bins[i]={selected:!0}),this.bins[i].key!=this.data[s][0]&&(this.bins[i].key=this.data[s][0],this.drawn=!1);this.nbins=h}for(i in this.bins)this.bins[i]&&(this.bins[i].value=0,this.bins[i].values=[])}else{if(a){for(var r=-(e=1e100),o={},l=0;l<this.data.length;l++)this.data[l][0]<e&&(e=this.data[l][0]),this.data[l][0]>r&&(r=this.data[l][0]);t.inc&&!t.update?(o.max=t.max?t.max:r,o.min=t.min?t.min:e,o.inc=t.inc):o=this.getGrid(e,r,t.mintick),o.range=o.max-o.min,o.bins=Math.round(.5+o.range/o.inc),this.drawn=!1,this.bins=[],this.max=o.max,this.min=o.min,this.inc=o.inc,this.range=o.range,this.nbins=o.bins}for("number"!=typeof this.nbins&&(this.nbins=Math.ceil(this.range/this.inc)),i=0;i<this.nbins;i++)this.bins[i]||(this.bins[i]={selected:!0}),this.bins[i].value=0,this.bins[i].values=[],this.bins[i].key=""+(this.min+i*this.inc)}for(t.mintick&&(this.mintick=t.mintick),s=0;s<this.data.length;s++)if(i=this.bin(this.data[s][0]),void 0!==this.data[s][1])if(1<this.data[s][1].length)for(e=0;e<this.data[s][1].length;e++)"number"!=typeof this.bins[i].values[e]&&(this.bins[i].values[e]=0),this.bins[i].value+=parseFloat(this.data[s][1][e]),this.bins[i].values[e]+=parseFloat(this.data[s][1][e]);else"number"!=typeof this.bins[i].values[0]&&(this.bins[i].values[0]=0),this.bins[i].value+=parseFloat(this.data[s][1]),this.bins[i].values[0]+=parseFloat(this.data[s][1]);return this},e.prototype.getYRange=function(){for(var t=0,i=0,s=0;s<this.nbins;s++){this.bins[s].value>t&&(t=this.bins[s].value);for(var e=0,a=0;a<this.bins[s].values.length;a++)e+=this.bins[s].values[a];e<0&&(i=e)}return{min:i,max:t}},e.prototype.draw=function(){var t=this.target.substr(1).replace(/^([^\s]+).*$/,function(t,i){return i});if(!this.target||!this.bins)return this;var i=0,s=0;if(0<this.nbins){for(S(this.target).addClass("barchart").css({"margin-bottom":"2.25em"}),"number"!=typeof this.lineheight&&(S(this.target).append('<table class="remove"><tr><td><span class="label">label</span></td></tr></table>'),styles=window.getComputedStyle(S(this.target).find("table .label")[0]),this.lineheight=parseInt(styles.lineHeight)+parseInt(styles.paddingBottom)+parseInt(styles.paddingTop),S(this.target).find(".remove").remove()),this.height||(this.height=S(this.target)[0].offsetHeight||parseInt(S(this.target).css("height"))||200),h=this.height-this.lineheight,s=this.attr.ymin?this.attr.ymin:0,u=0;u<this.nbins;u++){for(this.bins[u].value>i&&(i=this.bins[u].value),v=m=0;v<this.bins[u].values.length;v++)m+=this.bins[u].values[v];m<0&&m<s&&(s=m)}this.drawn||S(this.target).html('<div class="grid" style="height:100%;"></div><table style="height:100%"><tr style="vertical-align:bottom;"></tr></table><div style="clear:both;"></div>'),this.attr.ymax&&this.attr.ymax>i&&(i=this.attr.ymax);var e,a,n,r,o,l=this.getGrid(s,i),b="",d=i-s;h=100;for(var f=0;f<=l.max;f+=l.inc)b+='<div class="line" style="bottom:'+(h*(f-s)/d).toFixed(4)+'%;"><span>'+("function"==typeof this.attr.formatY?this.attr.formatY.call(this,f,{units:this.attr.units}):(this.attr.units||"")+this.formatNumber(f))+"</span></div>";S(this.target+" .grid").html(b);for(var c=0==S(this.target+" table td").length,b="",u=0;u<this.nbins;u++){for(horig=-1,e=this.bins[u].key,a=h*(0<i?Math.abs(this.bins[u].value/d):0),v=m=0;v<this.bins[u].values.length;v++)m+=this.bins[u].values[v];if(htop=h*((m<0?i:i-m)/d),hbot=Math.abs(h*((0<=m?s:m-s)/d)),isNaN(htop)&&(htop=h),n=a,horig<0&&(horig=htop+n),hc=h-htop-n,htop<0&&(htop=0),hbot<0&&(hbot=0),hc<0&&(hc=0),r=t+"-bar-"+("string"==typeof e?u:e.replace(/ /g,"-")),this.bins[u].id=r,cls=this.bins[u].selected?"":" deselected",cls=(cls?" ":"")+this.attr.formatBar.call(this,e,this.bins[u].value),c){if(b+='<td id="'+r+'" style="width:'+(100/this.nbins).toFixed(3)+'%;height:100%;" class="'+(this.bins[u].selected?"":" deselected")+cls+'" data-index="'+u+'"><div class="antibar" style="height:'+htop.toFixed(4)+'%;"></div>',0<this.bins[u].values.length){r=t+"-bar-"+("string"==typeof e?u:e.replace(/ /g,"-")),e=this.bins[u].key;for(var m=0,v=this.bins[u].values.length-1;0<=v;v--)m+=Math.abs(this.bins[u].values[v]);for(v=this.bins[u].values.length-1;0<=v;v--)hbb=n*(Math.abs(this.bins[u].values[v])/m),isNaN(hbb)&&(hbb=0),b+='<a href="#" class="bar '+this.attr.formatBar.call(this,e,this.bins[u].values[v],v)+'" title="'+e+": "+(this.attr.units||"")+this.formatNumber(this.bins[u].values[v])+'" data-index-series="'+v+'" style="height:'+hbb.toFixed(4)+'%;"></a>'}else hbb=0,b+='<a href="#" class="bar '+this.attr.formatBar.call(this,e,0,v)+'" title="'+e+": "+(this.attr.units||"")+this.formatNumber(0)+'" data-index-series="'+v+'" style="height:'+hbb+'px;"></a>';b+='<div class="antibar" style="height:'+hbot.toFixed(4)+'%;"></div><div class="barbase"></div>'+("string"==typeof e&&e.indexOf("-01")||-1==e.indexOf("-")?'<span class="label">'+this.attr.formatX.call(this,e)+"</span>":"")+"</td>"}else{o=S("#"+r),S(o.find(".antibar")[0]).css({height:htop.toFixed(4)+"%"}),S(o.find(".antibar")[1]).css({height:hbot.toFixed(4)+"%"});for(var p=o.find(".bar"),g=0;g<p.length;g++){var y=S(p[g]);v=parseInt(y.attr("data-index-series")),m=0;for(var x=this.bins[u].values.length-1;0<=x;x--)m+=Math.abs(this.bins[u].values[x]);hbb=n*(Math.abs(this.bins[u].values[v])/m),isNaN(hbb)&&(hbb=0),y.css({height:hbb.toFixed(4)+"%"}).attr("title",e+": "+(this.attr.units||"")+this.formatNumber(this.bins[u].values[v]))}o.find(".label").html(this.attr.formatX.call(this,e))}}c&&(S(this.target+" table tr").html(b),S(this.target).on("mouseleave",{me:this},function(t){t.data&&t.data.me.trigger("mouseleave",{event:t})}),S(this.target).on("mouseover",{me:this},function(t){t.data.me.trigger("mouseover",{event:t})})),this.drawn||S(this.target+" .bar").on("focus",{me:this,parent:this.attr.parent},function(t){t.currentTarget=t.currentTarget.parentNode,t.data.me.trigger("barover",{event:t,bin:S(t.currentTarget).attr("data-index"),series:S(t.currentTarget).attr("data-index-series")})}).parent().on("click",{me:this,parent:this.attr.parent},function(t){t.preventDefault(),t.data.me.trigger("barclick",{event:t,bin:S(t.currentTarget).attr("data-index")})}).on("mouseover",{me:this,parent:this.attr.parent},function(t){t.data.me.trigger("barover",{event:t,bin:S(t.currentTarget).attr("data-index")})}),this.drawn=!0}return this},e.prototype.on=function(t,i,s){return"string"!=typeof t||"object"!=typeof(i=void 0===s?(s=i,{}):{data:i})||"function"!=typeof s||(this.events[t]?this.events[t].push({e:i,fn:s}):this.events[t]=[{e:i,fn:s}]),this},e.prototype.off=function(t){return"string"!=typeof t||"object"==typeof this.events[t]&&(this.events[t]=[]),this},e.prototype.trigger=function(t,i){if("string"==typeof t){"object"!=typeof i&&(i={});var s=[];if("object"==typeof this.events[t])for(var e=0;e<this.events[t].length;e++){var a=n.extend(this.events[t][e].e,i);"function"==typeof this.events[t][e].fn&&s.push(this.events[t][e].fn.call(this,a))}return 0<s.length?s:void 0}},e.prototype.getGrid=function(t,i,s){var e=i-t;s=s||3;var a=Math.pow(10,Math.floor(Math.log(e)/Math.log(10)));a*=2;var n=Math.floor(i/a)*a;n<i&&(n+=a);for(var h=n,r=0;r++,t<(h-=a););for(Math.abs(h)<1e-15&&(h=0);r<s;)h+(a/=2)<=t&&(h+=a),i<=n-a&&(n-=a),r*=2;return i<n&&(n-=a),{min:h,max:n,inc:a,range:n-h}},e.prototype.formatNumber=function(t){return"number"!=typeof t?t:1e11<=t?Math.round(t/1e9)+"B":1e10<=t?(t/1e9).toFixed(1).replace(/\.?0+$/,"")+"B":1e9<=t?(t/1e9).toFixed(2).replace(/\.?0+$/,"")+"B":1e8<=t?Math.round(t/1e6)+"M":1e7<=t?(t/1e6).toFixed(1).replace(/\.0*$/,"")+"M":1e6<=t?(t/1e6).toFixed(2).replace(/\.0*$/,"")+"M":1e5<=t||1e4<=t?Math.round(t/1e3)+"k":(""+t).replace(/0{5,}1$/,"")},S.barchart=function(t,i,s){return new e(t,i)}}(S);